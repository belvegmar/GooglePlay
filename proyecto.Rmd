---
title: "GooglePlay"
author: "Belen_Miguel"
date: "18 de diciembre de 2018"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r, include=FALSE}
#install.packages(c("plyr"))
library("plyr")
```

# Lectura de los datos
```{r cars}
datos <- read.csv(file="googleplaystore.csv", header=TRUE, sep=",", stringsAsFactors = FALSE)

```

# Echamos un vistazo al dataset
```{r}
str(datos)

```

# Limpieza de datos y transformación
El primer paso será hacer un preprocesamiento de cada uno de los atributos con vista a obtener mejores resultados en los algoritmos de minería de datos

## Size
Se puede obsrevar que los datos del tamaño de las aplicaciones tienen prefijos métricos (Kilo y Mega). Para poder hacer un análisis de datos efectivo, se eliminarán estos símbolos por sus correspondientes equivalencias numéricas.
Además de estos símbolos hay apps cuyo tamaño varían con el dispositivo ("Varies with devices"), estos ejemplos se sustituirán por valores nulos. Por otro lado, también hay instancias que tienen como valor "1000+", estas se sustituirán por 1000. En resumen, las tareas que se van a realizar son las siguientes:

* Reemplazar "Varies with devices" por NaN
* Convertir k y M a numérico
* Pasar 1.000+ a 1000 para hacerlo numérico

```{r}
for (i in 1:length(datos$Size)) { 
  if(grepl("M",datos$Size[i])){
    numero <- as.numeric(gsub("M", "e+06", datos$Size[i]))
    datos$Size[i]<- numero
  } else if (grepl("k", datos$Size[i])){
    numero <- as.numeric(gsub("k", "e+03", datos$Size[i]))
    datos$Size[i] <- numero
  }else if (grepl("Varies", datos$Size[i])){
    datos$Size[i] <- NaN
  }else{
    datos$Size[i]<-1000
  }
}

datos$Size <- as.numeric(datos$Size)

```

## Reviews
Comprobaremos si los valores del atributo "Reviews" son de tipo numérico:
```{r}
datos$Reviews <- as.numeric(datos$Reviews)

```
Se puede observar que al convertir la columna a número, un valor no se ha podido convertir, ya que no había forma. Daremos un vistazo previo a esta fila:
```{r}
for (i in 1:length(datos$Reviews)) {
  if(is.na(datos$Reviews[i])){
    print(i)
    print(datos[i,])
    datos <- datos[-i,]
    
  }
}

print(datos[10471:10480,])

```
Como solo es una fila, se optará por eliminarla directamente. En la representación de arriba se ve cómo ha desaparecido del dataframe.

## Convertir "Installs" en numeric

Removemos el simbolo (+) y luego convertimos a numerico. Comprobamos los cambios.

```{r}
datos$Installs <- as.numeric(gsub(",", "", gsub("+", "", datos$Installs, fixed = TRUE), fixed=TRUE))
options("scipen"=100, "digits"=4)
str(datos$Installs)
print(unique(datos$Installs))
```


## Price
```{r}
print(unique(datos$Price))
```
Se puede observar que la variable precio tiene un carácter $ que hay que eliminar para poder convertirlo en número. Además, hay varias columnas que tienen valores raros ("Everyone"), estas filas las eliminaremos
```{r}
for (i in 1:length(datos$Price)){
  datos$Price[i] <- as.numeric((gsub("\\$","", datos$Price[i])))
}
#Eliminar valores NAN
for (i in 1:length(datos$Price)){
  if(is.na(datos$Price[i])){
    print(i)
    print(datos[i,])
    datos <- datos[-i,]
    
  }
}

```
Lo más curioso es que hay aplicaciones que superan los 350 dólares, tal como se puede ver en el histograma a continuación:
```{r}
hist(as.numeric(datos$Price), col="blue1")
for (i in 1:length(datos$Price)){
  if(as.numeric(datos$Price[i])>350){
    print(datos[i,])
  }
}

```
## Last updated
Convertir la fecha que está en formato String a Date
```{r}
for (i in 1:length(datos$Last.Updated)){
  datos$FechaUltima[i]<-as.Date(as.character(datos$Last.Updated[i]), format = "%B %d, %Y",origin='1970-01-01')
}
```
## Current version

Convertir versiones a números
```{r}
for (i in 1:length(datos$Current.Ver)){
  if(datos$Current.Ver[i]!="Varies with device"){
    datos$Current.Ver[i]<-as.numeric(substr(as.character(datos$Current.Ver[i]),0,3))
  }
} 
```
Reemplazar los valores nulos con "Varies with device"
```{r}
for (i in 1:length(datos$Current.Ver)){
  if(is.na(datos$Current.Ver[i])){
    datos$Current.Ver[i]<-"Varies with device"
  }
}
```

```{r}
w <- as.data.frame(table(datos$Current.Ver))
w<-w[order(-w$Freq),]
head(w)

```

